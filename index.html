<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rotcod Data Bundles</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f3f4f6; }
  header { background: #1e40af; color: white; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; }
  header h1 { margin: 0; font-size: 24px; display: flex; align-items: center; gap: 10px; }
  nav a { color: white; text-decoration: none; margin-left: 15px; font-weight: bold; }
  nav a:hover { text-decoration: underline; }
  main { padding: 20px; }
  #bundleList { display: grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap: 20px; margin-top: 20px; }
  .bundle-item { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; }
  .bundle-item button { background: #1e40af; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
  .bundle-item button:hover { background: #2563eb; }
  footer { text-align: center; padding: 15px; background: #1e40af; color: white; margin-top: 30px; }
  .popup { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; }
  .popup-content { background: white; padding: 20px; border-radius: 10px; text-align: center; width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .popup-content button { margin-top: 15px; background: #1e40af; color: white; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; }
  .popup-content button:hover { background: #2563eb; }
  section { margin-top: 30px; }
  a.whatsapp-link { color: #25D366; font-weight: bold; text-decoration: none; }
  a.whatsapp-link:hover { text-decoration: underline; }
</style>
</head>
<body>

<header>
  <h1>ðŸ“¡ Rotcod Data Bundles</h1>
  <nav>
    <a href="#home" onclick="showSection('home')">Home</a>
    <a href="#about" onclick="showSection('about')">About</a>
    <a href="#contact" onclick="showSection('contact')">Contact</a>
  </nav>
</header>

<main>
  <!-- Home Section -->
  <section id="home">
    <h2>ðŸ“± Choose your bundle below</h2>
    <div id="bundleList"></div>
  </section>

  <!-- About Section -->
  <section id="about" style="display:none;">
    <h2>About Rotcod Data Bundles</h2>
    <p>We provide the most reliable and affordable data bundles. Stay connected with Rotcod!</p>
    <button onclick="showSection('home')">Go Back Home</button>
  </section>

  <!-- Contact Section -->
  <section id="contact" style="display:none;">
    <h2>Contact</h2>
    <p>WhatsApp: <a class="whatsapp-link" href="https://wa.me/254710234904" target="_blank">0710234904</a></p>
    <p>Name: <strong>Doctor Rotcod</strong></p>
    <button onclick="showSection('home')">Go Back Home</button>
  </section>
</main>

<!-- M-Pesa Payment Popup -->
<div id="mpesaPopup" class="popup">
  <div class="popup-content">
    <div class="message"></div>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<script>
  // Navigation
  function showSection(id) {
    ['home','about','contact'].forEach(sec => {
      document.getElementById(sec).style.display = (sec === id ? 'block' : 'none');
    });
  }

  // Load bundles from Render backend
  async function loadBundles() {
    try {
      const res = await fetch("https://rotcod-backend.onrender.com/api/bundles");
      const data = await res.json();
      const container = document.getElementById("bundleList");
      container.innerHTML = "";
      data.forEach(b => {
        const item = document.createElement("div");
        item.className = "bundle-item";
        item.innerHTML = `
          <h3>${b.name}</h3>
          <p>Price: ${b.price} KES</p>
          <p>Duration: ${b.duration}</p>
          <button onclick="buyBundle('${b.name}', '${b.price}')">ðŸ’³ Buy Now</button>
        `;
        container.appendChild(item);
      });
    } catch (error) {
      console.error("Failed to load bundles:", error);
      document.getElementById("bundleList").innerHTML = "<p style='color:red;'>Failed to load bundles. Try again later.</p>";
    }
  }

  // Buy bundle triggers popup
  function buyBundle(bundleName, price) {
    showMPesaPopup(bundleName, price);
  }

  // Popup Simulation
  function showMPesaPopup(bundleName, price) {
    const popup = document.getElementById("mpesaPopup");
    const message = popup.querySelector(".message");
    message.innerHTML = `Processing payment for ${bundleName}...`;
    popup.style.display = "flex";

    setTimeout(() => {
      const txId = Date.now();
      message.innerHTML = `
        âœ… Payment successful!<br>
        Bundle: ${bundleName}<br>
        Price: ${price} KES<br>
        Transaction ID: ${txId}<br>
        ${new Date().toLocaleString()}
      `;
      fetch("https://rotcod-backend.onrender.com/api/buy", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ bundleName, price, fee: 0, profit: 0 })
      });
    }, 2000);
  }

  // Close popup
  function closePopup() {
    document.getElementById("mpesaPopup").style.display = "none";
  }

  loadBundles();
</script>

<footer>
Â© 2025 Rotcod Data Bundles â€” Stay Connected!
</footer>

</body>
</html>
